const onLoadGlobal=()=>{const gameScreen=document.querySelector(".game-screen"),portal=document.querySelector(".portal"),btnStart=document.querySelector("#btn-ini"),arrowLeft=document.querySelector("#esq"),arrowRight=document.querySelector("#dir"),btnPause=document.querySelector("#pause"),arrows=document.querySelectorAll(".panel i");let portalIntervalRight,portalIntervalLeft,targetsInterval,watchInterval,pauseInterval,paused=!1,gameOn=!1,gameEnd=!1,pts=0,imp=0,countAster=0;class Target{constructor(div,speed){this.target=div,this.target.className="target animate",this.maxLeft=this.target.parentElement.offsetWidth-100,this.maxTop=this.target.parentElement.offsetHeight,this.randomLeftPos=Math.floor(Math.random()*(this.maxLeft-5)+5),this.target.style.left=this.randomLeftPos+"px",this.speed=speed,this.explosion=this.target.parentElement.appendChild(document.createElement("div")),this.explosion.className="impact",this.explosion.style.left=this.randomLeftPos+10+"px"}_animateTarget(){this.target.animate([{top:this.target.offsetTop+"px"},{top:this.maxTop+"px"}],this.speed)}_missedTarget(){this.target.className="target burned",setTimeout(()=>{this.target.remove(),this.explosion.style.display="block"},200),setTimeout(()=>this.explosion.remove(),400)}_getTargetPosition(){return this.target.getBoundingClientRect()}}const updatePanel=(pts,imp)=>{const avoided=document.querySelector("#avoided"),impacts=document.querySelector("#impacts");avoided.innerHTML=pts,impacts.innerHTML=imp};updatePanel(pts,imp);const showResult=(pts,imp,perc)=>{let result;result=perc<70?document.querySelector(".bad"):document.querySelector(".good");let finalPts=result.querySelector(".final-pts"),finalImp=result.querySelector(".final-imp"),showPerc=result.querySelector(".perc");result.style.display="block",finalPts.innerHTML=pts,finalImp.innerHTML=imp,showPerc.innerHTML=perc+"%"},removeTargets=()=>{let targetExists1=document.querySelector(".target");if(!targetExists1)return!1;targetExists1.remove(),countAster--},pauseGame=()=>{const textPause=document.querySelector(".paused");if(paused)return!1;paused=!0,clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft),clearInterval(watchInterval),removeTargets(),pauseInterval=setInterval(()=>{textPause.style.display="block",setTimeout(()=>textPause.style.display="none",500)},1e3)},endGame=numAsteroids=>{clearInterval(targetsInterval),clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft),clearInterval(watchInterval),removeTargets();let perc=Math.floor(pts/numAsteroids*100);showResult(pts,imp,perc),gameEnd=!0},watchTarget=target=>{let targetBottom=target._getTargetPosition().bottom,targetLeft=target._getTargetPosition().left,targetRight=target._getTargetPosition().right,portalTop=portal.getBoundingClientRect().top-7,portalLeft=portal.getBoundingClientRect().left-20,portalRight=portal.getBoundingClientRect().right+20;return targetBottom>portalTop+50?(target._missedTarget(),imp++,clearInterval(watchInterval),void updatePanel(pts,imp)):targetBottom>=portalTop&&targetBottom<=portalTop+50&&targetLeft>=portalLeft&&targetRight<=portalRight?(pts++,target.target.remove(),clearInterval(watchInterval),void updatePanel(pts,imp)):void 0},createTargets=speed=>{const div=gameScreen.appendChild(document.createElement("div"));target=new Target(div,speed),target._animateTarget(),watchInterval=setInterval(()=>watchTarget(target),100)},runGame=()=>{let speed=1600;window.innerWidth>900&&(speed=2e3),window.innerWidth<400&&(speed=1400);let numAsteroids=Math.floor(21*Math.random()+50);gameOn=!0,paused=!1,targetsInterval=setInterval(()=>{if(!(!paused&&gameOn&&countAster<=numAsteroids))return!1;createTargets(speed),countAster++,countAster>numAsteroids&&endGame(numAsteroids)},speed)},toggleArrowsOnMob=display=>{if(0===navigator.maxTouchPoints)return!1;arrows.forEach(thisArrow=>thisArrow.style.display=display)},newGame=()=>{if(gameOn){gameOn=!1;const alert=document.querySelector(".alert");alert.style.display="block",toggleArrowsOnMob("none"),document.querySelector("#yes").addEventListener("click",()=>location.reload()),document.querySelector("#no").addEventListener("click",()=>{toggleArrowsOnMob("block"),alert.style.display="none",gameOn=!0})}},animRight=()=>{portal.offsetLeft<=gameScreen.offsetWidth-portal.offsetWidth-5?portal.style.left=portal.offsetLeft+5+"px":clearInterval(portalIntervalRight)},animLeft=()=>{portal.offsetLeft>5?portal.style.left=portal.offsetLeft-5+"px":clearInterval(portalIntervalLeft)};if(arrowRight.addEventListener("mousedown",()=>{paused||!gameOn||gameEnd||(portalIntervalRight=setInterval(()=>animRight(),0))}),arrowLeft.addEventListener("mousedown",()=>{paused||!gameOn||gameEnd||(portalIntervalLeft=setInterval(()=>animLeft(),0))}),arrowRight.addEventListener("mouseup",()=>{clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft)}),arrowLeft.addEventListener("mouseup",()=>{clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft)}),0!==navigator.maxTouchPoints){let timeClick1,timeClick2;arrowRight.addEventListener("touchstart",e=>{timeClick1=e.timeStamp,clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft),Math.abs(timeClick1-timeClick2)<300||paused||!gameOn||gameEnd||(portalIntervalRight=setInterval(()=>animRight(),0))}),arrowLeft.addEventListener("touchstart",e=>{timeClick2=e.timeStamp,clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft),Math.abs(timeClick1-timeClick2)<300||paused||!gameOn||gameEnd||(portalIntervalLeft=setInterval(()=>animLeft(),0))}),arrowRight.addEventListener("touchend",()=>{clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft)}),arrowLeft.addEventListener("touchend",()=>{clearInterval(portalIntervalRight),clearInterval(portalIntervalLeft)})}btnStart.addEventListener("click",e=>{const startScreen=document.querySelector(".start-screen");startScreen.style.display="none",toggleArrowsOnMob("block"),clearInterval(pauseInterval),gameOn?gameEnd||gameOn&&!paused?newGame():paused?paused=!1:e.preventDefault():runGame()}),btnPause.addEventListener("click",e=>{gameOn&&!gameEnd?pauseGame():e.preventDefault()}),window.addEventListener("orientationchange",()=>{gameOn&&!gameEnd?pauseGame():location.reload()})};onLoadGlobal();